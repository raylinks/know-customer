"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.destroyWithFlush = exports.flushMetrics = exports.countVariant = exports.count = exports.forceGetVariant = exports.getVariant = exports.getFeatureToggleDefinitions = exports.getFeatureToggleDefinition = exports.destroy = exports.isEnabled = exports.startUnleash = exports.initialize = exports.UnleashEvents = exports.InMemStorageProvider = exports.Unleash = exports.PayloadType = exports.Strategy = void 0;
const events_1 = require("events");
const unleash_1 = require("./unleash");
Object.defineProperty(exports, "Unleash", { enumerable: true, get: function () { return unleash_1.Unleash; } });
const variant_1 = require("./variant");
Object.defineProperty(exports, "PayloadType", { enumerable: true, get: function () { return variant_1.PayloadType; } });
const events_2 = require("./events");
Object.defineProperty(exports, "UnleashEvents", { enumerable: true, get: function () { return events_2.UnleashEvents; } });
const storage_provider_in_mem_1 = require("./repository/storage-provider-in-mem");
exports.InMemStorageProvider = storage_provider_in_mem_1.default;
// exports
var index_1 = require("./strategy/index");
Object.defineProperty(exports, "Strategy", { enumerable: true, get: function () { return index_1.Strategy; } });
let instance;
function initialize(options) {
    instance = unleash_1.Unleash.getInstance(options);
    return instance;
}
exports.initialize = initialize;
async function startUnleash(options) {
    const unleash = initialize(options);
    if (!unleash.isSynchronized()) {
        await (0, events_1.once)(unleash, 'synchronized');
    }
    return unleash;
}
exports.startUnleash = startUnleash;
function isEnabled(name, context = {}, fallbackValue) {
    return instance ? instance.isEnabled(name, context, fallbackValue) : !!fallbackValue;
}
exports.isEnabled = isEnabled;
function destroy() {
    if (instance) {
        instance.destroy();
    }
    instance = undefined;
}
exports.destroy = destroy;
function getFeatureToggleDefinition(toggleName) {
    return instance && instance.getFeatureToggleDefinition(toggleName);
}
exports.getFeatureToggleDefinition = getFeatureToggleDefinition;
function getFeatureToggleDefinitions(withFullSegments = false) {
    return instance && instance.getFeatureToggleDefinitions(withFullSegments);
}
exports.getFeatureToggleDefinitions = getFeatureToggleDefinitions;
function getVariant(name, context = {}, fallbackVariant) {
    const variant = fallbackVariant || variant_1.defaultVariant;
    return instance ? instance.getVariant(name, context, variant) : variant;
}
exports.getVariant = getVariant;
function forceGetVariant(name, context = {}, fallbackVariant) {
    const variant = fallbackVariant || variant_1.defaultVariant;
    return instance ? instance.forceGetVariant(name, context, variant) : variant;
}
exports.forceGetVariant = forceGetVariant;
function count(toggleName, enabled) {
    return instance && instance.count(toggleName, enabled);
}
exports.count = count;
function countVariant(toggleName, variantName) {
    return instance && instance.countVariant(toggleName, variantName);
}
exports.countVariant = countVariant;
async function flushMetrics() {
    return instance && instance.flushMetrics();
}
exports.flushMetrics = flushMetrics;
async function destroyWithFlush() {
    return instance && instance.destroyWithFlush();
}
exports.destroyWithFlush = destroyWithFlush;
//# sourceMappingURL=index.js.map